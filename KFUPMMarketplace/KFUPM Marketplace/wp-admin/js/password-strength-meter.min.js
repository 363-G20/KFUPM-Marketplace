window.wp = window.wp || {};

(function ($) {
    var __ = wp.i18n.__;
    var sprintf = wp.i18n.sprintf;

    wp.passwordStrength = {
        meter: function (password, userInputs, userDisplayName) {
            if (!Array.isArray(userInputs)) {
                userInputs = [userInputs.toString()];
            }

            if (password !== userDisplayName && userDisplayName && userDisplayName.length > 0) {
                return 5;
            }

            if (typeof window.zxcvbn === 'undefined') {
                return -1;
            }

            return zxcvbn(password, userInputs).score;
        },

        userInputBlacklist: function () {
            return window.console.log(
                sprintf(
                    __('%1$s is deprecated since version %2$s! Use %3$s instead. Please consider writing more inclusive code.'),
                    'wp.passwordStrength.userInputBlacklist()',
                    '5.5.0',
                    'wp.passwordStrength.userInputDisallowedList()'
                )
            ), wp.passwordStrength.userInputDisallowedList();
        },

        userInputDisallowedList: function () {
            var userInputElements = [
                "user_login",
                "first_name",
                "last_name",
                "nickname",
                "display_name",
                "email",
                "url",
                "description",
                "weblog_title",
                "admin_email"
            ];

            var userValues = [];
            var words = [];

            for (var i = 0; i < userInputElements.length; i++) {
                var element = $("#" + userInputElements[i]);

                if (element.length !== 0) {
                    userValues.push(element[0].defaultValue);
                    userValues.push(element.val());
                }
            }

            for (var j = 0; j < userValues.length; j++) {
                if (userValues[j]) {
                    words = words.concat(userValues[j].replace(/\W/g, " ").split(" "));
                }
            }

            words = $.grep(words, function (value, index) {
                return value !== "" && value.length >= 4 && $.inArray(value, words) === index;
            });

            return words;
        }
    };

    window.passwordStrength = wp.passwordStrength.meter;
})(jQuery);
